
@{
    Layout = null;
}
@using DIGITAL_GAMIFY.Code
<!DOCTYPE html>
<html>
<head>
    <title>SmartQuiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <link href="~/customercontent/css/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
    <link href="~/customercontent/css/styles.css" type="text/css" rel="stylesheet" media="all">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script>
        var websiteurlapi = '@Globalsettings.GetWebSiteUrlApi()';
        var websiteurl = '@Globalsettings.GetWebSiteUrl()';
        //alert(currenturl);
       @*@{
            var cid = 0;
            if (cid == 0)
            {
                Response.Redirect("~/Guest/Register");
            }
        }*@
    </script>
</head>
<body>
    <div class="main-row">
        <div class="">
            <div class="">
                <div class="frame-border">
                    <input type="hidden" id="BusinessId" value="0" />
                    <input type="hidden" id="GameName" value="" />
                    <input type="hidden" id="lastchance" value="">
                    <input type="hidden" id="PhysicalPrize1" value="" />
                    <input type="hidden" id="PhysicalPrize2" value="" />
                    <div class="container-fluid p-0 content-h boxscroll do-nicescrol4">
                        <div class="wrap" id="gameinfo" style="display:block">
                            <div class="mt-8 mb-3">
                                <div class="">
                                    <div class="my-2 chmy-1"><img src="" class="img-fluid w-51 quizimage"></div>
                                </div>
                                <h6>"Smart Quiz"   is Designed For User-Friendly Purpose. Users Can Get Some Virtual Points In This  Scratching Some Cards. Scratch Cards Are Depends On The  given Questions. Points In Cards Opens Randomly.</h6>

                                <h6>Users Must Know :-</h6>

                                <h6>"We Don't Collect Any Information."</h6>

                                <h6>App Functionality :-</h6>

                                <h6>Smart Quiz  is Developed As User-Friendly.  Will See  Play Button You Will Click To Enter Into Quiz. In This quiz You Will Get Virtual Points And You Will win Prize,  if  You Answered - Correctly 5 or more Questions, will get 100 % Prize,  later you can Redeem your Prize(s).</h6>
                            </div>
                            <div class="py-3 text-center">
                                <button type="button" class="btn btn-info" onclick="Play()">Play</button>
                            </div>
                        </div>
                        <div class="wrap" id="nogames" style="display:none">
                            <div class="mt-4 mb-3">
                                <div class="mt-3"><img src="~/Content/images/logo.png" class="img-fl  uid w-50" height="100px"></div>
                                <h4 class="t-color">Hi ,</h4>
                                <h6 class="px-3 py-3" id="statusmessage"></h6>
                            </div>
                        </div>
                        <div style="display:none" id="prizedetails">
                            <h6 class="px-3 py-3" id="prizemessage"></h6>
                            <div class="mt-3 mb-1"><img id="prize" src="" class="img-fl  uid w-50" height="100px"></div>
                            <div id="complimentary" style="display:block">
                                <h6 class="px-3 py-3">
                                    please provide the following details to claim the prize.
                                </h6>
                                <div id="physical1" style="display:none"></div>

                                <div id="physical2" style="display:none"></div>

                                <div class="form-group">
                                    <textarea class="form-control" name="Address" id="Address" placeholder="Address"></textarea>
                                </div>

                            </div>
                            <div class="col-md-12 text-center ">
                                <button type="button" class=" btn btn-block mybtn text-white g-btn tx-tfm" onclick="Finish()">Continue</button>
                            </div>
                        </div>
                        <div class="wrap" id="game" style="display:none">
                            <input type="hidden" name="gid" id="gid" value="@Request.QueryString["id"]" />
                            <input type="hidden" id="" value="@ViewBag.url" />
                            <input type="hidden" name="CustomerId" id="CustomerId" value="@Request.QueryString["cid"]" />
                            <input type="hidden" name="email" id="email" value="@Request.QueryString["_m"]" />

                            <div>
                                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                                    <div class="carousel-inner">
                                        <div class="carousel-item active">
                                            <img class="d-block w-100 quizimage" src="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="t-color mx-3 text-left">
                                @*<p class="para-wel"><b class="quizq"></b></p>*@
                                <div>
                                    <h6><span class="quizq"></span></h6>
                                    <input type="hidden" name="quizquestionid" id="quizquestionid" />
                                    <input type="hidden" name="CorrectAnswer" id="CorrectAnswer" />
                                    <input type="hidden" id="AnsweredId" value="0" />
                                </div>
                                <div class="row m-0">
                                    @*<img src="~/customercontent/images/3.png" hidden="hidden" id="swipe" />*@
                                    <div class="col">

                                        <div class="scratch1" style="z-index:1000;position: relative;margin:0 auto;
  -webkit-transform: translate(-50%, 0%);
  -moz-transform: translate(-50%, 0%);    /* Older Gecko browser */
  -ms-transform: translate(-50%, 0%);     /* IE9+ */
  -o-transform: translate(-50%, 0%);
  transform: translate(7%, 0%);text-align:center;">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="scratch2" style="z-index:1000;position: relative;margin:0 auto;
  -webkit-transform: translate(-50%, 0%);
  -moz-transform: translate(-50%, 0%);    /* Older Gecko browser */
  -ms-transform: translate(-50%, 0%);     /* IE9+ */
  -o-transform: translate(-50%, 0%);
  transform: translate(7%, 0%);text-align:center;">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="scratch3" style="z-index:1000;position: relative;margin:0 auto;
  -webkit-transform: translate(-50%, 0%);
  -moz-transform: translate(-50%, 0%);    /* Older Gecko browser */
  -ms-transform: translate(-50%, 0%);     /* IE9+ */
  -o-transform: translate(-50%, 0%);
  transform: translate(7%, 0%);text-align:center;">
                                        </div>
                                    </div>


                                    @*<div class="col"><img src="~/customercontent/images/1.jpg" class="img-fluid" /></div>
                        <div class="col"><img src="~/customercontent/images/4.jpg" class="img-fluid" /></div>
                        <div class="col"><img src="~/customercontent/images/3.jpg" class="img-fluid" /></div>*@
                                </div>
                                <div class="py-3 text-center" id="btn" style="display:none">
                                    <button type="button" class="btn btn-info" onclick="InsertAnswer()">Next</button>
                                </div>
                                <div class="py-3 text-center" id="finish" style="display:none">
                                    <button type="button" class="btn btn-info" onclick="PrizeComplimentary()">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="circle-button"></div>
            </div>
        </div>
    </div>
    <input type="hidden" id="redeemcode" />
    <input type="hidden" id="PrizeId" value="0" />
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="~/customercontent/js/jquery-3.5.1.slim.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script> -->
    <script type="text/javascript" src="~/Content/js/jquery.min.js"></script>
    <script src="~/customercontent/js/popper.min.js"></script>
    <script src="~/customercontent/js/bootstrap.min.js"></script>
    <script src="~/customercontent/js/global.js"></script>
    <!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery.nicescroll/3.7.6/jquery.nicescroll.js"></script>
    <script type="text/javascript">
        $(".do-nicescrol4").niceScroll(".wrap");
    </script>
    <script type="text/javascript">$("body").niceScroll();</script> -->
    
    <script src="~/customercontent/js/wScratchPad1.js"></script>
    <img src="~/customercontent/images/Correct.jpg" hidden="hidden" id="corrct"/>
    <img src="~/customercontent/images/Wrong.jpg" hidden="hidden" id="wrong" />
    

    <script>
        //function PrizeComplimentary() {
        //    var prize = $("#PrizeId").val();
        //    $("#game").css("display", "none");
        //    $("#prizedetails").css("display", "block");
        //}
        function Play() {
            $("#gameinfo").css("display", "none");
            $("#game").css("display", "block");
        }
        var gid = $('#gid').val();
        var cid = $('#CustomerId').val();
        getsmartquizbyid();
        function getsmartquizbyid() {
            $("#btn").css("display", "block");
            $("#AnsweredId").val(0);
                gl.ajaxreq(websiteurlapi + 'GetSmartQuizById', 'get', { sid: gid, cid: cid }, function (response) {
                    if (response.IsFinished == 0 && response.Questions.SmartQuizDetails.LastChance != 3) {
                        $("#PhysicalPrize1").val(response.Questions.SmartQuizDetails.PhysicalPrize1);
                        $("#PhysicalPrize2").val(response.Questions.SmartQuizDetails.PhysicalPrize2);
                        $("#BusinessId").val(response.Questions.SmartQuizDetails.BusinessId);
                        $("#GameName").val(response.Questions.SmartQuizDetails.QuizName);
                        $("#lastchance").val(response.Questions.SmartQuizDetails.LastChance);
                        if ($(".quizimage").attr('src') == "") {
                            $(".quizimage").attr('src', response.Questions.SmartQuizDetails.SmartQuizImagepath);
                            $.each(response.Questions.SmartQuizDetails.Attrlist, function (a, attri) {
                                $('#physical1').append('<div class="form-group">' +
                             '<label class="col-sm-2 control-label">' + attri.Attribute + '</label>' +
                             '<select name="' + attri.Attribute + '" class="form-control" id="physical1' + attri.Attribute + '" aria-describedby="emailHelp" placeholder="Enter Colour">' +
                             '</select>' +
                             '</div>' 
                            );
                                $.each(attri.values, function (i, size) {
                                    $('#physical1' + attri.Attribute).append("<option value='" + size + "'>" + size + "</option>");
                                });
                            });
                            $.each(response.Questions.SmartQuizDetails.Attrlist2, function (a, attri) {
                                $('#physical2').append('<div class="form-group">' +
                             '<label class="col-sm-2 control-label">' + attri.Attribute + '</label>' +
                             '<select name="' + attri.Attribute + '" class="form-control" id="physical2' + attri.Attribute + '" aria-describedby="emailHelp" placeholder="Enter Colour">' +
                             '</select>' +
                             '</div>' 
                             );
                                $.each(attri.values, function (i, size) {
                                    $('#physical2' + attri.Attribute).append("<option value='" + size + "'>" + size + "</option>");
                                });
                            });
                        }
                        $('.quizq').html(response.Questions.Question[0].QuestionNum + ') ' + response.Questions.Question[0].Question + ':');
                        $('#quizquestionid').val(response.Questions.Question[0].SmartQuizQuestionId);
                        $('#CorrectAnswer').val(response.Questions.Question[0].CorrectAnswerId);
                        $.each(response.Questions.Question[0].answers, function (j, itemans) {
                            i = j + 1;
                            $('.scratch' + i).html('');
                            var sp2 = $(".scratch" + i).wScratchPad1({
                                scratchDown: function (e, percent) { ChkScratch(percent, itemans.AnswerNumber) },
                                scratchMove: function (e, percent) { ChkScratch(percent, itemans.AnswerNumber) },
                                scratchUp: function (e, percent) { ChkScratch(percent, itemans.AnswerNumber) },
                                image: response.Questions.Question[0].CorrectAnswerId == i ? $("#corrct").attr('src') : $("#wrong").attr('src'),
                                image2: itemans.AnswerImagePath,
                                width: 80,
                                height: 80
                            });
                        });
                    } else {
                        $("#gameinfo").css("display", "none");
                        $("#statusmessage").html(response.StatusMessage)
                        $("#nogames").css("display", "block");
                    }
                }, '', '', '', '', false, false);
            }
    </script>
    <script>
        function ChkScratch(p, id) {
            if (id == 1) {
                //console.log(p);
                $('.scratch2').wScratchPad1('enabled', false);
                $('.scratch3').wScratchPad1('enabled', false);
                if (p >= 10) {
                    $("#AnsweredId").val(id);
                    //InsertAnswer(id);
            }
        }
        if (id == 2) {
            $('.scratch1').wScratchPad1('enabled', false);
            $('.scratch3').wScratchPad1('enabled', false);
            if (p >= 10) {
                $("#AnsweredId").val(id);
                //InsertAnswer(id);
        }
        }
        if (id == 3) {
            $('.scratch1').wScratchPad1('enabled', false);
            $('.scratch2').wScratchPad1('enabled', false);
            if (p >= 10) {
                $("#AnsweredId").val(id);
                //InsertAnswer(id);
        }
        }
        }
        function InsertAnswer() {
            if ($("#AnsweredId").val() == 0) {
               alert('Please scratch the Answer.');
                return;
            } else {
                var aid = $("#AnsweredId").val();
                var cid = $("#CustomerId").val();
                var sid = $("#gid").val();
                var qid = $("#quizquestionid").val();
                var atext = $("#CorrectAnswer").val();
                if (aid == atext) {
                    var answer = 1;
                } else {
                    var answer = 0;
                }

                gl.ajaxreq(websiteurlapi + 'InsertCustomerSmartQuizAnswer', 'get', { sqid: sid, cid: cid, qid: qid, aid: aid, IsCorrect: answer, Duration: 0 }, function (response) {
                    if (response.IsFinished == 1) {
                        if (response.PrizeDetails.PrizeNumber == 0) {
                            response.PrizeDetails.PrizePath = websiteurl + '/customercontent/images/avatars-000490611378-ivdfi5-t500x500.jpg';
                        }
                        if (response.PrizeDetails.PrizeNumber == 0 || response.PrizeDetails.PrizeNumber == 3) {
                            $("#prizemessage").html('<span>' + response.PrizeDetails.PrizeMessage + '</span>');
                        } else {
                            $("#prizemessage").html('Congratulations you have won a great prize.<br/><span>' + response.PrizeDetails.PrizeMessage + '</span>');
                        }
                        $("#prize").attr("src", response.PrizeDetails.PrizePath);
                        $("#PrizeId").val(response.PrizeDetails.PrizeNumber);
                        $("#redeemcode").val(response.RedeemCode);
                        if (($("#PrizeId").val() == 1 || $("#PrizeId").val() == 2) && ($("#PhysicalPrize1").val() == 1 || $("#PhysicalPrize2").val() == 1)) {
                            $("#complimentary").css("display", "block");
                            if ($("#PrizeId").val() == 1) {
                                $("#physical1").css("display", "block");
                                $("#physical2").html('');
                            }
                            if ($("#PrizeId").val() == 2) {
                                $("#physical2").css("display", "block");
                                $("#physical1").html('');
                            }
                        }
                        else {
                            $("#complimentary").css("display", "none");
                        }
                        $("#game").css("display", "none");
                        $("#prizedetails").css("display", "block");
                        gl.ajaxreq(websiteurlapi + 'SendDigitalGamifyPrizeNotification', 'post', { Email: $("#email").val(), GameId: $("#gid").val(), PrizeNumber: $("#PrizeId").val(), BusinessId: $("#BusinessId").val(), RedeemCode: $("#redeemcode").val(), Title: $("#GameName").val(), PrizePath: $("#prize").attr("src"), PrizeDetails: $("#prizemessage").val(), Type: 3, LastChance: $("#lastchance").val(), GameimgPath: $(".quizimage").attr('src') }, function (resp) {

                        });
                        //PrizeComplimentary();
                    } else {
                        getsmartquizbyid();
                    }
                }, '', '', '', '', false, false);
            }
        }
        function Finish() {
            var cid = $("#CustomerId").val();
            var sid = $("#gid").val();
            var prize = $("#PrizeId").val();
            var redeemcode = $("#redeemcode").val();
            var size = $('[name="Size"]').val() == undefined ? "" : $('[name="Size"]').val();
            var colour = $('[name="Color"]').val() == undefined ? "" : $('[name="Color"]').val();
            var address = $("#Address").val() == undefined ? "" : $("#Address").val();
            gl.ajaxreq(websiteurlapi + 'CustomerSmartQuizRedeemPrize', 'get', { sid: sid, cid: cid, PrizeId: 0, RedeemCode: redeemcode, Size: size, Colour: colour, interval: "", intervalid: 0, Address: address }, function (response) {
                //window.location.href = "@Url.Action("Finish", "Guest")";
            }, '', '', '', '', false, false);
            window.location.href = "Finish?id=" + $("#BusinessId").val();
            //window.location.href = "@Url.Action("Finish", "Guest")";

        };
    </script>

</body>
</html>
