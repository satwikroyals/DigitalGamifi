
@{
    Layout = null;
}
@using DIGITAL_GAMIFY.Code;
<!DOCTYPE html>

<html>
<head>
    <title>Quiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <link href="~/customercontent/css/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
    <link href="~/customercontent/css/styles.css" type="text/css" rel="stylesheet" media="all">
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script>
        var websiteurlapi = '@Globalsettings.GetWebSiteUrlApi()';
        var websiteurl = '@Globalsettings.GetWebSiteUrl()';
    </script>
</head>
<body>
    <div class="">
        <div class="">
            <div class="">
                <div class="frame-border">
                    <input type="hidden" id="BusinessId" value="0" />
                    <input type="hidden" id="GameName" value="" />
                    <input type="hidden" id="lastchance" value="" />
                    <input type="hidden" id="PhysicalPrize1" value="" />
                    <input type="hidden" id="PhysicalPrize2" value="" />
                    <div class="container-fluid p-0 content-h boxscroll do-nicescrol4">
                        <div class="wrap" id="nogames" style="display: none;text-align: center;">
                            <div class="mt-4 mb-1">
                                <div class="mt-3"><img src="~/Content/images/logo.png" class="img-fl  uid w-50" height="100px"></div>
                                <h4 class="t-color">Hi ,</h4>
                                <h6 class="px-3 py-3" id="statusmessage"></h6>
                            </div>
                        </div>
                        <div style="display: none;text-align: center;" id="prizedetails">
                            <h6 class="px-3 py-3" id="prizemessage"></h6>
                            <div class="mt-3 mb-1"><img id="prize" src="" class="img-fl  uid w-50" height="100px"></div>
                            <div id="complimentary" style="display:block">
                                <h6 class="px-3 py-3">
                                    please provide the following details to claim the prize.
                                </h6>
                                <div id="physical1" style="display:none"></div>

                                <div id="physical2" style="display:none"></div>

                                <div class="form-group">
                                    <textarea class="form-control" name="Address" id="Address" placeholder="Address"></textarea>
                                </div>
                            </div>
                            <div class="col-md-12 text-center">
                                <button type="button" class=" btn btn-block mybtn text-white g-btn tx-tfm" onclick="Finish()">Continue</button>
                            </div>
                        </div>
                        <div class="wrap" id="game">
                            <input type="hidden" id="gid" value="@Request.QueryString["id"]" />
                            <input type="hidden" id="" value="@ViewBag.url" />
                            <input type="hidden" id="CustomerId" value="@Request.QueryString["cid"]" />
                            <input type="hidden" id="email" value="@Request.QueryString["_m"]" />
                            <div>
                                <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                                    <div class="carousel-inner">
                                        <div class="carousel-item active surimage">

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <div class="finger-lightly-wrapper">
                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <div class="welcome-image-wrapper">
                                            <p class="para-wel"><b class="surveyq"></b></p>
                                            <input type="hidden" id="Surveyquestionid" />
                                            <input type="hidden" id="CorrectAnswer" />
                                            <form>
                                                <div class="welcome-choice surveya">

                                                </div>
                                            </form>
                                        </div>
                                    </div>

                                </div>
                                <div class="mt-4 mb-3" id="btn" style="display:none">
                                    <div class="col-md-4 text-center ">
                                        <button type="button" class=" btn btn-block mybtn text-white g-btn tx-tfm" onclick="InsertAnswer()">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="circle-button"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" id="redeemcode" />
    <input type="hidden" id="PrizeId" value="0" />
 


    <script src="~/customercontent/js/jquery-3.5.1.slim.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script> -->
    <script type="text/javascript" src="~/Content/js/jquery.min.js"></script>
    
    <script src="~/customercontent/js/popper.min.js"></script>
    <script src="~/customercontent/js/bootstrap.min.js"></script>
    <script src="~/customercontent/js/global.js"></script>
    <img src="~/customercontent/images/avatars-000490611378-ivdfi5-t500x500.jpg" hidden="hidden" id="swipe" />
    <script src="~/customercontent/js/wScratchPad.js"></script>
    <script>

    var gid = $('#gid').val();
    var cid = $('#CustomerId').val();

    function show() {
        $("#btn").css("display", "block");
    }

    getquizbybyid();

    function getquizbybyid() {
        gl.ajaxreq(websiteurlapi + 'GetQuizById', 'get', { sid: gid, cid: cid }, function (response) {
            if (response.IsFinished == 0 && response.Questions.QuizDetails.LastChance!=3) {
                $("#PhysicalPrize1").val(response.Questions.QuizDetails.PhysicalPrize1);
                $("#PhysicalPrize2").val(response.Questions.QuizDetails.PhysicalPrize2);
                $("#BusinessId").val(response.Questions.QuizDetails.BusinessId);
                $("#GameName").val(response.Questions.QuizDetails.QuizName);
                $("#lastchance").val(response.Questions.QuizDetails.LastChance);
                $(".surimage").append('<img class="d-block w-100" id="QuizImage" src="' + response.Questions.QuizDetails.QuizImagepath + '" alt="First slide">')
                $('.surveyq').html(response.Questions.Question[0].QuestionNum + ') ' + response.Questions.Question[0].Question + ':');
                $('#Surveyquestionid').val(response.Questions.Question[0].QuizQuestionId);
                $('#CorrectAnswer').val(response.Questions.Question[0].CorrectAnswerId);
                $.each(response.Questions.QuizDetails.Attrlist, function (a, attri) {

                    $('#physical1').append('<div class="form-group">' +
                 '<label class="col-sm-2 control-label">' + attri.Attribute + '</label>' +
                 '<select name="' + attri.Attribute + '" class="form-control" id="physical1' + attri.Attribute + '" aria-describedby="emailHelp" placeholder="Enter Colour">' +
                 '</select>' +
                 '</div>');
                    $.each(attri.values, function (i, size) {
                        $('#physical1' + attri.Attribute).append("<option value='" + size + "'>" + size + "</option>");
                    });
                });
                $.each(response.Questions.QuizDetails.Attrlist2, function (a, attri) {

                    $('#physical2').append('<div class="form-group">' +
                 '<label class="col-sm-2 control-label">' + attri.Attribute + '</label>' +
                 '<select name="' + attri.Attribute + '" class="form-control" id="physical2' + attri.Attribute + '" aria-describedby="emailHelp" placeholder="Enter Colour">' +
                 '</select>' +
                 '</div>');
                    $.each(attri.values, function (i, size) {
                        $('#physical2' + attri.Attribute).append("<option value='" + size + "'>" + size + "</option>");
                    });
                });
                $.each(response.Questions.Question[0].answers, function (k, itemans) {
                    $('.surveya').append('<div>' +
                 '<input type="radio" id="huey" name="answer" onchange="show()" value="' + itemans.AnswerNumber + '">' +
                 '<label>' + itemans.Answer + '</label>' +
                 '</div>');
                });
            } else {
                $("#game").css("display", "none");
                $("#statusmessage").html(response.StatusMessage)
                $("#nogames").css("display", "block");
            }
        }, '', '', '', '', false, false);
    }
    function InsertAnswer() {
        var cid = $("#CustomerId").val();
        var sid = $("#gid").val();
        var qid = $("#Surveyquestionid").val();
        var aid = $("input[name=answer]:checked").val();
        var atext = $("#CorrectAnswer").val();
        if (aid == atext) {
            var answer = 1;
        } else {
            var answer = 0;
        }
        var dt = new Date();

        gl.ajaxreq(websiteurlapi + 'InsertCustomerQuizAnswer', 'get', { quid: sid, cid: cid, qid: qid, aid: aid, IsCorrect: answer, Duration: 0 }, function (response) {
            $('.surveya').html('');
            if (response.IsFinished == 0) {
                $('.surveyq').html(response.Questions.QuestionNum + ') ' + response.Questions.Question + ':');
                $('#Surveyquestionid').val(response.Questions.QuizQuestionId);
                $('#CorrectAnswer').val(response.Questions.CorrectAnswerId);
                $.each(response.Questions.answers, function (k, itemans) {
                    $('.surveya').append('<div>' +
                 '<input type="radio" id="huey" name="answer" onchange="show()" value="' + itemans.AnswerNumber + '">' +
                 '<label>' + itemans.Answer + '</label>' +
                 '</div>');
                });
            } else {
                if (response.PrizeDetails.PrizeNumber == 0) {
                    response.PrizeDetails.PrizePath = websiteurl + '/customercontent/images/avatars-000490611378-ivdfi5-t500x500.jpg';
                }
                if (response.PrizeDetails.PrizeNumber == 0 || response.PrizeDetails.PrizeNumber == 3) {
                    $("#prizemessage").html('<span>' + response.PrizeDetails.PrizeMessage + '</span>');
                } else {
                    $("#prizemessage").html('Congratulations you have won a great prize.<br/><span>' + response.PrizeDetails.PrizeMessage + '</span>');
                }
                $("#prize").attr("src", response.PrizeDetails.PrizePath);
                $("#PrizeId").val(response.PrizeDetails.PrizeNumber);
                $("#redeemcode").val(response.RedeemCode);
                if (($("#PrizeId").val() ==1 || $("#PrizeId").val()==2)&&($("#PhysicalPrize1").val() ==1||$("#PhysicalPrize2").val() ==1)) {
                    $("#complimentary").css("display", "block");
                    if ($("#PrizeId").val() == 1) {
                        $("#physical1").css("display", "block");
                        $("#physical2").html('');
                    }
                    if ($("#PrizeId").val() == 2) {
                        $("#physical2").css("display", "block");
                        $("#physical1").html('');
                    }
                }
                else {
                    $("#complimentary").css("display", "none");
                }
                $("#game").css("display", "none");
                $("#prizedetails").css("display", "block");
                gl.ajaxreq(websiteurlapi + 'SendDigitalGamifyPrizeNotification', 'post', { Email: $("#email").val(), GameId: $("#gid").val(), PrizeNumber: $("#PrizeId").val(), BusinessId: $("#BusinessId").val(), RedeemCode: $("#redeemcode").val(), Title: $("#GameName").val(), PrizePath: $("#prize").attr("src"), PrizeDetails: $("#prizemessage").val(), Type: 2, LastChance: $("#lastchance").val(), GameimgPath: $("#QuizImage").attr('src') }, function (resp) {

                });
            }
            $("#btn").css("display", "none");
        }, '', '', '', '', false, false);
    }
    function Finish() {
            var prize = $("#PrizeId").val();
            var cid = $("#CustomerId").val();
            var sid = $("#gid").val();
            var size = $('[name="Size"]').val();
            var size = $('[name="Size"]').val() == undefined ? "" : $('[name="Size"]').val();
            var colour = $('[name="Color"]').val() == undefined ? "" : $('[name="Color"]').val();
            var address = $("#Address").val() == undefined ? "" : $("#Address").val();
            gl.ajaxreq(websiteurlapi + 'CustomerQuizRedeemPrize', 'get', { sid: sid, cid: cid, PrizeId: prize, RedeemCode: redeemcode, Size: size, Colour: colour, interval: "", intervalid: 0, Address: address }, function (response) {
                
            }, '', '', '', '', false, false);
            window.location.href = "Finish?id=" + $("#BusinessId").val();
        //window.location.href = "@Url.Action("Finish", "Guest")";

    };

    function msToHMS(ms) {
        // 1- Convert to seconds:
        var seconds = ms / 1000;
        // 2- Extract hours:
        var hours = parseInt(seconds / 3600); // 3,600 seconds in 1 hour
        seconds = seconds % 3600; // seconds remaining after extracting hours
        // 3- Extract minutes:
        var minutes = parseInt(seconds / 60); // 60 seconds in 1 minute
        // 4- Keep only seconds not extracted to minutes:
        seconds = seconds % 60;
        alert(hours + " hours and " + minutes + " minutes and " + seconds + " seconds!");
    }
</script>
</body>
</html>

